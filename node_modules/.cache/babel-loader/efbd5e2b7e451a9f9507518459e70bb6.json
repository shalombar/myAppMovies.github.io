{"ast":null,"code":"import * as actions from '../actions/general.act';\nimport * as Functions from '../common/functions/functions';\n\nvar axios = require('axios');\n\nexport default (function (store) {\n  return function (next) {\n    return function (action) {\n      if (action.type == 'API') {\n        var SERVER_ENDPOINT = \"http://localhost:3000/moviesList\";\n        var OMDb_API = 'http://www.omdbapi.com/?apikey=81d51a00';\n        var _action$payload = action.payload,\n            type = _action$payload.type,\n            method = _action$payload.method,\n            index = _action$payload.index,\n            newData = _action$payload.newData,\n            newDatas = _action$payload.newDatas,\n            id = _action$payload.id,\n            currentDb = _action$payload.currentDb;\n        var api = {\n          'get': function get(data) {\n            // axios.get(SERVER_ENDPOINT).then((res) => {\n            store.dispatch(actions.api(type, data)); // })\n            // .catch((err) => console.log(err))\n          },\n          'post': function post(newMovie) {\n            // axios.post((SERVER_ENDPOINT), newMovie).then((res) => {\n            store.dispatch(actions.api(type, newMovie)); // })\n            // .catch((err) => console.log(err))\n          },\n          'put': function put() {\n            // axios.put((SERVER_ENDPOINT + '/' + index + '/'), newData).then((res) => {\n            store.dispatch(actions.api(type, newDatas)); // })\n            // .catch((err) => console.log(err))\n          },\n          'delete': function _delete() {\n            // axios.delete(SERVER_ENDPOINT + '/' + index + '/').then((res) => {\n            store.dispatch(actions.api(type, newDatas)); // })\n            // .catch((err) => console.log(err))\n          }\n        };\n\n        if (action.payload.first) {\n          var i;\n\n          (function () {\n            var _generateMovieId = function _generateMovieId(datas) {\n              var id = Math.floor(Math.random() * 1000 + 1);\n\n              while (_isIdExist(datas, id)) {\n                id = Math.floor(Math.random() * 1000 + 1);\n              }\n\n              return id;\n            };\n\n            var _isIdExist = function _isIdExist(datas, id) {\n              var moviesList = this.props.general.moviesList;\n\n              for (var i = 0; i < datas.length; ++i) {\n                var movie = datas[i];\n\n                if (movie.id == id) {\n                  return true;\n                }\n              }\n\n              return false;\n            };\n\n            var movies = action.payload.moviesList;\n            var data = [];\n            console.log('czc', movies);\n\n            for (i = 0; i < movies; ++i) {\n              axios.get(OMDb_API + '&t=' + movies[i].Title).then(function (response) {\n                var id = _generateMovieId(data);\n\n                var movie = response.data;\n                movie['id'] = id;\n                data.push(movie);\n                store.dispatch(actions.getMoviesList(data));\n              }).catch(function (err) {\n                return console.log('err');\n              });\n            }\n          })();\n        }\n\n        if (type == 'ADD') {\n          var title = newData.title.replace(' ', '+');\n          axios.get(OMDb_API + '&t=' + title + '&y=' + newData.year).then(function (respone) {\n            var newMovie = respone.data;\n            newMovie['id'] = id;\n\n            if (!Functions.isMovieExist(currentDb, newMovie.imdbID)) {\n              api[method](newMovie);\n              store.dispatch(actions.isMovieExist(false));\n            } else {\n              store.dispatch(actions.isMovieExist(true));\n            }\n          }).catch(function (err) {\n            return console.log(err);\n          });\n        } else {\n          api[method]();\n        }\n      }\n\n      return next(action);\n    };\n  };\n});","map":{"version":3,"sources":["C:\\Users\\shalombar\\Desktop\\my-new-app\\src\\middleware\\general.mid.js"],"names":["actions","Functions","axios","require","store","next","action","type","SERVER_ENDPOINT","OMDb_API","payload","method","index","newData","newDatas","id","currentDb","api","data","dispatch","newMovie","first","i","_generateMovieId","datas","Math","floor","random","_isIdExist","moviesList","props","general","length","movie","movies","console","log","get","Title","then","response","push","getMoviesList","catch","err","title","replace","year","respone","isMovieExist","imdbID"],"mappings":"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","sourcesContent":["import * as actions from '../actions/general.act';\r\nimport * as Functions from '../common/functions/functions';\r\n\r\nconst axios = require('axios');\r\n\r\nexport default store => next => action => {\r\n    if (action.type == 'API') {\r\n        const SERVER_ENDPOINT = \"http://localhost:3000/moviesList\";\r\n        const OMDb_API = 'http://www.omdbapi.com/?apikey=81d51a00';\r\n\r\n        let { type, method, index, newData, newDatas, id, currentDb } = action.payload;\r\n\r\n        let api = {\r\n            'get': (data) => {\r\n                // axios.get(SERVER_ENDPOINT).then((res) => {\r\n                store.dispatch(actions.api(type, data))\r\n                // })\r\n                // .catch((err) => console.log(err))\r\n            },\r\n            'post': (newMovie) => {\r\n                // axios.post((SERVER_ENDPOINT), newMovie).then((res) => {\r\n                store.dispatch(actions.api(type, newMovie))\r\n                // })\r\n                // .catch((err) => console.log(err))\r\n            },\r\n            'put': () => {\r\n                // axios.put((SERVER_ENDPOINT + '/' + index + '/'), newData).then((res) => {\r\n                store.dispatch(actions.api(type, newDatas))\r\n                // })\r\n                // .catch((err) => console.log(err))\r\n            },\r\n            'delete': () => {\r\n                // axios.delete(SERVER_ENDPOINT + '/' + index + '/').then((res) => {\r\n                store.dispatch(actions.api(type, newDatas))\r\n                // })\r\n                // .catch((err) => console.log(err))\r\n            }\r\n        }\r\n\r\n        if (action.payload.first) {\r\n            let movies = action.payload.moviesList;\r\n            let data = [];\r\n            console.log('czc',movies)\r\n\r\n\r\n            for (var i = 0; i < movies; ++i) {\r\n                axios.get(OMDb_API + '&t=' + movies[i].Title ).then((response) => {\r\n                    let id = _generateMovieId(data);\r\n                    let movie = response.data;\r\n\r\n                    movie['id'] = id;\r\n                    data.push(movie);\r\n                    store.dispatch(actions.getMoviesList(data))\r\n                })\r\n                .catch((err)=>console.log('err'))\r\n            }\r\n\r\n\r\n\r\n            function _generateMovieId(datas) {\r\n                let id = Math.floor((Math.random() * 1000) + 1);\r\n\r\n                while (_isIdExist(datas, id)) {\r\n                    id = Math.floor((Math.random() * 1000) + 1);\r\n                }\r\n\r\n                return id;\r\n            }\r\n\r\n            function _isIdExist(datas, id) {\r\n                let moviesList = this.props.general.moviesList;\r\n\r\n                for (var i = 0; i < datas.length; ++i) {\r\n                    let movie = datas[i];\r\n\r\n                    if (movie.id == id) {\r\n                        return true;\r\n                    }\r\n                }\r\n\r\n                return false;\r\n            }\r\n        }\r\n\r\n        if (type == 'ADD') {\r\n            let title = newData.title.replace(' ', '+');\r\n\r\n            axios.get(OMDb_API + '&t=' + title + '&y=' + newData.year).then((respone) => {\r\n                let newMovie = respone.data;\r\n\r\n                newMovie['id'] = id;\r\n                if (!Functions.isMovieExist(currentDb, newMovie.imdbID)) {\r\n                    api[method](newMovie);\r\n                    store.dispatch(actions.isMovieExist(false))\r\n                }\r\n                else {\r\n                    store.dispatch(actions.isMovieExist(true))\r\n                }\r\n            })\r\n                .catch((err) => console.log(err))\r\n        }\r\n        else {\r\n            api[method]();\r\n        }\r\n    }\r\n    return next(action)\r\n}"]},"metadata":{},"sourceType":"module"}